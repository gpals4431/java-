package xyz.itwill09.mvc;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

//ì»¨íŠ¸ë¡¤ëŸ¬(Controller) : ?´?¼?´?–¸?Š¸?˜ ëª¨ë“  ?š”ì²??„ ë°›ì•„ URL ì£¼ì†Œë¥? ë¶„ì„?•˜?—¬ ?•„?š”?•œ ?š”ì²? ì²˜ë¦¬ 
//?´?˜?Š¤(Model)?˜ ë©”ì†Œ?“œë¥? ?˜¸ì¶œí•˜?—¬ ?´?¼?´?–¸?Š¸?˜ ?š”ì²??„ ì²˜ë¦¬?•˜ê³? JSP ë¬¸ì„œ(View)ë¡? ?Š¤? ˆ?“œë¥? 
//?´?™?•˜?—¬ ?‘?‹µì²˜ë¦¬ ?˜?„ë¡? ?”„ë¡œê·¸?¨?˜ ?ë¦„ì„ ? œ?–´?•˜?Š” ê¸°ëŠ¥ ? œê³? - ?„œë¸”ë¦¿(Servlet)?œ¼ë¡? êµ¬í˜„

//ì»¨íŠ¸ë¡¤ëŸ¬ ê¸°ëŠ¥?„ ? œê³µí•˜ê¸? ?œ„?•œ ?„œë¸”ë¦¿ ?´?˜?Š¤
// => ?´?¼?´?–¸?Š¸?˜ ëª¨ë“  ?š”ì²??„ ë°›ì•„ ì²˜ë¦¬?•˜?Š” ?‹¨?¼ ì§„ì…? ?˜ ?—­?™œ?„ ?ˆ˜?–‰ - Front Controller Pattern
// => [web.xml] ?ŒŒ?¼?—?„œ ?´?˜?Š¤ë¥? ?„œë¸”ë¦¿(?›¹?”„ë¡œê·¸?¨)?œ¼ë¡? ?“±ë¡í•˜ê³? ?´?¼?´?–¸?Š¸?˜ ëª¨ë“  ?š”ì²??„ 
//ë°›ì•„ ì²˜ë¦¬?•  ?ˆ˜ ?ˆ?„ë¡? URL ?Œ¨?„´ ?„¤? •
public class DispatcherServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;

	//?´?¼?´?–¸?Š¸?˜ ?š”ì²??„ ì²˜ë¦¬?•˜ê¸? ?œ„?•œ ??™ ?˜¸ì¶œë˜?Š” ë©”ì†Œ?“œë¥? ?˜¤ë²„ë¼?´?“œ ?„ ?–¸
	@Override
	protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		//1.?´?¼?´?–¸?Š¸?˜ ?š”ì²? URL ì£¼ì†Œë¥? ë¶„ì„?•˜?—¬ ?š”ì²?? •ë³´ë?? ë°˜í™˜ë°›ì•„ ???¥
		String requestURI=request.getRequestURI();
		String contextPath=request.getContextPath();
		String command=requestURI.substring(contextPath.length());
		
		//2.?´?¼?´?–¸?Š¸?˜ ?š”ì²?? •ë³´ë?? ?´?š©?•˜?—¬ ?š”ì²? ì²˜ë¦¬ ?´?˜?Š¤(Model)?˜ ê°ì²´ë¥? ? œê³µë°›?•„ ê°ì²´?˜
		//ë©”ì†Œ?“œ ?˜¸ì¶œí•˜?—¬ ?´?¼?´?–¸?Š¸?˜ ?š”ì²??„ ì²˜ë¦¬?•˜ê³? ?‘?‹µ ê´?? ¨ ? •ë³?(View)ë¥? ë°˜í™˜ë°›ì•„ ???¥
		//?¸?„°?˜?´?Š¤ë¡? ì°¸ì¡°ë³??ˆ˜ë¥? ?„ ?–¸?•˜ë©? ?¸?„°?˜?´?Š¤ë¥? ?ƒ?†ë°›ì? ëª¨ë“  ??‹?´?˜?Š¤?˜ ê°ì²´ ???¥ ê°??Š¥
		/*
		Controller controller=null;
		//?´?¼?´?–¸?Š¸?˜ ?š”ì²?? •ë³´ë?? ë¹„êµ?•˜?—¬ ?š”ì²? ì²˜ë¦¬ ?´?˜?Š¤(Model)ë¡? ê°ì²´ë¥? ?ƒ?„±?•˜?—¬ ???¥
		if(command.equals("/list.itwill")) {
			controller=new ListController();
		} else if(command.equals("/view.itwill")) {
			controller=new ViewController();
		}
		*/
		
		//HandlerMapping ?´?˜?Š¤ë¡? ê°ì²´ ?ƒ?„±
		// => HandlerMapping ?´?˜?Š¤ :?´?¼?´?–¸?Š¸?˜ ?š”ì²?? •ë³´ì? ?š”ì²? ì²˜ë¦¬ ?´?˜?Š¤?˜ ê°ì²´ê°? ?—”?Š¸ë¦¬ë¡œ
		//???¥?œ Map ê°ì²´ë¥? ? œê³µí•˜ê¸? ?œ„?•œ ?´?˜?Š¤
		HandlerMapping handlerMapping=new HandlerMapping();
		//HandlerMapping ê°ì²´?˜ ë©”ì†Œ?“œë¥? ?˜¸ì¶œí•˜?—¬ ë§¤ê°œë³??ˆ˜?— ? „?‹¬?œ ?š”ì²?? •ë³´ì— ???•œ ?š”ì²? ì²˜ë¦¬
		//?´?˜?Š¤?˜ ê°ì²´ë¥? ë°˜í™˜ë°›ì•„ ???¥
		Controller controller=handlerMapping.getController(command);
		
		//?š”ì²? ì²˜ë¦¬ ?´?˜?Š¤?˜ ë©”ì†Œ?“œë¥? ?˜¸ì¶œí•˜?—¬ ?´?¼?´?–¸?Š¸?˜ ?š”ì²??„ ì²˜ë¦¬?•˜ê³? ?‘?‹µ ì²˜ë¦¬?•  JSP
		//ë¬¸ì„œ?˜ ?´ë¦?(ViewName)?„ ë°˜í™˜ë°›ì•„ ???¥
		String viewName=controller.handleRequest(request, response);
		
		//3.JSP ë¬¸ì„œë¡? ?¬?›Œ?“œ ?´?™?•˜?—¬ ?´?¼?´?–¸?Š¸?—ê²? ì²˜ë¦¬ê²°ê³¼ê°? ?‘?‹µ?˜?„ë¡? ì²˜ë¦¬
		// => ?š”ì²? ì²˜ë¦¬ ë©”ì†Œ?“œ?˜ ë°˜í™˜ê°?(ViewName)?„ ?´?š©?•˜?—¬ JSP ë¬¸ì„œ?˜ ê²½ë¡œë¥? ?™„?„±?•˜?—¬ ?¬?›Œ?“œ ?´?™
		//ViewResolver ?´?˜?Š¤ë¡? ê°ì²´ ?ƒ?„±
		// => ViewResolver ?´?˜?Š¤ : ?š”ì²? ì²˜ë¦¬ ë©”ì†Œ?“œ?˜ ë°˜í™˜ê°?(ViewName)?„ ?´?š©?•˜?—¬ ?‘?‹µ ì²˜ë¦¬?• 
		//JSP ë¬¸ì„œ?˜ ê²½ë¡œë¥? ?™„?„±?•˜?—¬ ë°˜í™˜?•˜?Š” ë©”ì†Œ?“œ
		ViewResolver viewResolver=new ViewResolver();
		String view=viewResolver.getView(viewName);//?‘?‹µ?•  JSP ë¬¸ì„œ?˜ ê²½ë¡œë¥? ë°˜í™˜ë°›ì•„ ???¥
		request.getRequestDispatcher(view).forward(request, response);//JSP ë¬¸ì„œë¡? ?¬?›Œ?“œ ?´?™
	}
}
